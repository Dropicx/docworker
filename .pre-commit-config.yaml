# Pre-commit hooks for DocTranslator
# https://pre-commit.com/
#
# Install: pre-commit install
# Run manually: pre-commit run --all-files
# Update hooks: pre-commit autoupdate

repos:
  # Ruff - Fast Python linter and formatter
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.8.4
    hooks:
      # Run the linter
      - id: ruff
        name: ruff lint
        args: [--fix]
        types_or: [python, pyi]

      # Run the formatter
      - id: ruff-format
        name: ruff format
        types_or: [python, pyi]

  # MyPy - Static type checker
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.13.0
    hooks:
      - id: mypy
        name: mypy type check
        additional_dependencies:
          - types-aiofiles
          - types-Pillow
          - types-PyYAML
          - types-redis
        args: [--config-file=backend/pyproject.toml]
        pass_filenames: false
        files: ^backend/app/

  # Python security checks
  - repo: https://github.com/PyCQA/bandit
    rev: 1.7.10
    hooks:
      - id: bandit
        name: bandit security check
        args: [-c, backend/pyproject.toml, -r, backend/app/]
        pass_filenames: false

  # Basic file checks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      # Prevent committing large files
      - id: check-added-large-files
        name: check large files
        args: [--maxkb=1000]

      # Check for files that would conflict on case-insensitive filesystems
      - id: check-case-conflict
        name: check case conflict

      # Check for merge conflict markers
      - id: check-merge-conflict
        name: check merge conflicts

      # Check JSON syntax
      - id: check-json
        name: check json

      # Check YAML syntax
      - id: check-yaml
        name: check yaml
        args: [--allow-multiple-documents]

      # Check TOML syntax
      - id: check-toml
        name: check toml

      # Ensure files end with a newline
      - id: end-of-file-fixer
        name: fix end of files

      # Remove trailing whitespace
      - id: trailing-whitespace
        name: trim trailing whitespace
        args: [--markdown-linebreak-ext=md]

      # Check for private keys
      - id: detect-private-key
        name: detect private keys

      # Check for AWS credentials
      - id: detect-aws-credentials
        name: detect aws credentials
        args: [--allow-missing-credentials]

      # Fix Python encoding pragmas
      - id: fix-encoding-pragma
        name: fix encoding pragma
        args: [--remove]

      # Sort requirements.txt
      - id: requirements-txt-fixer
        name: sort requirements.txt
        files: requirements.*\.txt$

  # Prettier - Frontend formatter
  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v4.0.0-alpha.8
    hooks:
      - id: prettier
        name: prettier format
        types_or: [javascript, jsx, ts, tsx, json, css, scss, markdown]
        exclude: ^backend/

  # ESLint - Frontend linter
  - repo: https://github.com/pre-commit/mirrors-eslint
    rev: v9.18.0
    hooks:
      - id: eslint
        name: eslint
        types_or: [javascript, jsx, ts, tsx]
        files: ^frontend/
        args: [--fix]
        additional_dependencies:
          - eslint@8.56.0
          - "@typescript-eslint/eslint-plugin@6.19.0"
          - "@typescript-eslint/parser@6.19.0"
          - eslint-plugin-react@7.33.2
          - eslint-plugin-react-hooks@4.6.0

  # Commit message format
  - repo: https://github.com/compilerla/conventional-pre-commit
    rev: v3.7.0
    hooks:
      - id: conventional-pre-commit
        name: conventional commit check
        stages: [commit-msg]
        args: [--strict, --force-scope]

  # Secret scanning
  - repo: https://github.com/gitleaks/gitleaks
    rev: v8.22.1
    hooks:
      - id: gitleaks
        name: gitleaks secret scan

# Configuration for pre-commit.ci (if using CI service)
ci:
  autofix_prs: true
  autoupdate_schedule: monthly
  skip: [mypy]  # Skip mypy in CI (too slow)
